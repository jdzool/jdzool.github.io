<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="This blog post was published on Valtech&#39;s team website and describes work completed at the Office of National Statistics (ONS) in Newport as part of the Statistical Business Register (SBR) Discovery. The project wrapped up at ONS on February 3rd 2017. The post has been modified for public consumption.
Key links describing future work are included at the end of this post.
Some background Broadly a business register keeps track of economic data, most importantly turnover, number of employees, sector, business ownership and some idea of the aggregation of the business group (i." />
<meta name="keywords" content=", external-blog, project-review" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://jdzool.github.io/posts/2017-a-case-of-the-business-registers/" />


    <title>
        
            Blog: A case of the Business Registers (ONS) :: Jon Downing 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.753fac8f03736f0edc9be411eb20cee875dd7bb8e73c8155fbf6a629c863f4ca.css">






<meta itemprop="name" content="Blog: A case of the Business Registers (ONS)">
<meta itemprop="description" content="This blog post was published on Valtech&#39;s team website and describes work completed at the Office of National Statistics (ONS) in Newport as part of the Statistical Business Register (SBR) Discovery. The project wrapped up at ONS on February 3rd 2017. The post has been modified for public consumption.
Key links describing future work are included at the end of this post.
Some background Broadly a business register keeps track of economic data, most importantly turnover, number of employees, sector, business ownership and some idea of the aggregation of the business group (i.">
<meta itemprop="datePublished" content="2017-02-03T11:23:31&#43;00:00" />
<meta itemprop="dateModified" content="2017-02-03T11:23:31&#43;00:00" />
<meta itemprop="wordCount" content="1647">
<meta itemprop="image" content="https://jdzool.github.io/gitlab"/>



<meta itemprop="keywords" content="external-blog,project-review," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://jdzool.github.io/gitlab"/>

<meta name="twitter:title" content="Blog: A case of the Business Registers (ONS)"/>
<meta name="twitter:description" content="This blog post was published on Valtech&#39;s team website and describes work completed at the Office of National Statistics (ONS) in Newport as part of the Statistical Business Register (SBR) Discovery. The project wrapped up at ONS on February 3rd 2017. The post has been modified for public consumption.
Key links describing future work are included at the end of this post.
Some background Broadly a business register keeps track of economic data, most importantly turnover, number of employees, sector, business ownership and some idea of the aggregation of the business group (i."/>



    <meta property="og:title" content="Blog: A case of the Business Registers (ONS)" />
<meta property="og:description" content="This blog post was published on Valtech&#39;s team website and describes work completed at the Office of National Statistics (ONS) in Newport as part of the Statistical Business Register (SBR) Discovery. The project wrapped up at ONS on February 3rd 2017. The post has been modified for public consumption.
Key links describing future work are included at the end of this post.
Some background Broadly a business register keeps track of economic data, most importantly turnover, number of employees, sector, business ownership and some idea of the aggregation of the business group (i." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jdzool.github.io/posts/2017-a-case-of-the-business-registers/" />
<meta property="og:image" content="https://jdzool.github.io/gitlab"/>
<meta property="article:published_time" content="2017-02-03T11:23:31+00:00" />
<meta property="article:modified_time" content="2017-02-03T11:23:31+00:00" />






    <meta property="article:published_time" content="2017-02-03 11:23:31 &#43;0000 GMT" />








    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">Jon Downing</span>
            <span class="logo__cursor" style=
                  "visibility:hidden;
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://jdzool.github.io/about">about</a></li><li><a href="https://jdzool.github.io/posts">blog</a></li><li><a href="https://jdzool.github.io/portfolio">portfolio</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>8 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://jdzool.github.io/posts/2017-a-case-of-the-business-registers/">Blog: A case of the Business Registers (ONS)</a>
            </h1>

            

            <div class="post-content">
                <p><code>This blog post was published on Valtech's team website and describes work completed at the Office of National Statistics (ONS) in Newport as part of the Statistical Business Register (SBR) Discovery. The project wrapped up at ONS on February 3rd 2017. The post has been modified for public consumption.</code></p>
<p><code>Key links describing future work are included at the end of this post.</code></p>
<h2 id="some-background">Some background</h2>
<p>Broadly a business register keeps track of economic data, most importantly turnover, number of employees, sector, business ownership and some idea of the aggregation of the business group (i.e. Tescos Supermarkets, Tescos Mobile etc.). Most countries have business registers and they’re used for economic analysis, policy decision making and in the creation of the all pervasive (and increasingly ineffective) value, GDP. In the UK, currently, the Inter-Departmental Business Register (IDBR) (a database) operates to deliver this information.</p>
<p>IDBR ingests VAT, Pay As You Earn (PAYE) and Companies House data to create regional and national statistics. You’ll be surprised to learn that these sources don’t cover a large proportion of the UK economy, those that work as self employed or have businesses under the PAYE employee limit are not reported.</p>
<p>Being unable to capture information about the whole of the economy, of course, hinders the use of the IDBR as the statistics generated are accurate only within the limits of the sampling population. As such new data sources (initially, Self Assessment) are to be included and this was one of the core changes (there are many others) proposed by Sir Bean is his evaluation of ONS (Independent Review of UK Economic Statistics, March 2016).</p>
<p>Following on ONS have proposed that IDBR is replaced by a suite of services &ndash; an Address Index (AI), a Business Index (BI) and a Statistical Business Register (SBR), all of which rest on a data management platform. This activity has already started (see AI and BI workstream) and while the work is clearly involved with creating new services for use, ONS must deal also with the replacement and transition away from the out-dated monolithic system of IDBR. Here, users rely on the consistency of statistics produced and many users sampling from the database only on an annual basis. Some users are worried about discontinuities of the statistics produced after a move to new system. These are valid concerns, statistics from IDBR are often used on a comparative basis with movements measured by shifts from a previous baseline; ‘employment up 3 %’ or &lsquo;GDP is down by 1 %&rsquo; (from last year&rsquo;s calculation) etc. Yet discontinuities can be present as the system function may change through improved methods of sampling, changes in interpolation methods used to calculate employment and turnover and as well a larger population of the economy considered by the inclusion of future datasets.</p>
<h2 id="the-plot-thickens">The plot thickens</h2>
<p>To compare new with current, an existing service function must be discovered to enable comparison and validation of both services. Unfortunately IDBR is a complex system with few subject matter experts and without complete documentation relating to the function of the database. As a core source of information we looked to analyse directly the numerous (3000+) stored procedures (referred to as programs from here in) employed within IDBR in order to reverse engineer the functionality of the system.</p>
<p>One caveat, prior to discussing the information gathered; this analysis is static – no information was gained about how users actually interact with the system. We did not have access to the live system and so analysis was completed on the passive infrastructure. In this instance, we did not attempt to gauge the proportion of code being used. Some program filenames had different versions presenting the fact that legacy code does exist. It is very likely that the scale of the problem is smaller than one addressed.</p>
<h2 id="the-evidence">The evidence</h2>
<p>In order to seek how the existing database functions and to be able to break this functionality into manageable parts for any transition, we must first understand how the data within the database is being accessed and manipulated. To do so, we first seek to map the connections between programs and tables as well as the connections between programs and sub-programs. In the second instance, discovering the relationships between programs and tables is of interest. In this case we know program A is connected to table B but how specifically does program A interact with table B, for example is it selecting data, updating data, deleting data? This approach is enabled by creating a graphical network where by all relationships can be mapped. In the final instance of this work (which we haven’t quite reached!) a user may search this connected web in order to piece together functionality from the various linked relationships.</p>
<p>To map connections; with a list of all table names (approx. 30,000) and all program names we were able to map the two against each other to create a network of programs calling tables and programs calling sub-programs. With a hierarchical structure (programs can call tables, tables cannot call programs), these graphs are directed. Directed graphs generally lack loops and so are termed acyclic.  On these initial networks we can run traversal algorithms to map the different steps that a program may be used against database data. This analysis gives the first insight into the function of IDBR.</p>
<figure class="center">
    <img src="/img/ONS_blog_word_match.png"
         alt="Left: visualisation of graphical database of tables (blue) and programs (green) tables with greater connections are larger, Right: program map for iss_pr_dets showing sub-program structure (potential calls from initial program)."/> <figcaption>
            <p>Left: visualisation of graphical database of tables (blue) and programs (green) tables with greater connections are larger, Right: program map for iss_pr_dets showing sub-program structure (potential calls from initial program).</p>
        </figcaption>
</figure>

<p>To map relationships we used a semantic analysis framework in Java – ANTLR (ANother Tool for Language Recognition), this provides a method to parse strings (pieces of code) against a pre-defined grammar. The output of the parsing process is itself is a set of hierarchical relationships where by leaves (end nodes) in the network are linked to programs though a series of labels assigned by the user (see figure, Annotated AST, &lsquo;TN_PARAM&rsquo;). This method enables us to find all tables within a program and allows us to label each by how it is being referenced. Semantic analysis by this method is able to parse nested queries and so gives a much larger amount of information with regard to the relationships between programs and tables than our initial matching program.</p>
<p>To facilitate the semantic analysis, I developed a computational pipeline which automates the process allowing us to apply the grammar and semantic analysis technique to any number of program files. On the back end of the pipeline I aggregated grammar errors and this aided in the optimisation of the process.</p>
<figure class="center">
    <img src="/img/ONS_blog_grammar.png"
         alt="ANTLR pipeline: Source files are input on left hand side, Lexer / Parser output creates Annotated Abstract Syntax Trees (AST) which are then added to enrich a graphical database showing connections / system functionality."/> <figcaption>
            <p>ANTLR pipeline: Source files are input on left hand side, Lexer / Parser output creates Annotated Abstract Syntax Trees (AST) which are then added to enrich a graphical database showing connections / system functionality.</p>
        </figcaption>
</figure>

<p>While this may sounds straight-forwards – sadly it wasn’t! The issue lies within the creation of grammar, there is no grammar for the Ingress 4th Generation Language (Ingres 4GL, the database language for IDBR). We wrote our grammar from scratch, which is not easy to get right. The main challenge is one of complexity, each time we changed the grammar something broke. It’s a whack-a-mole-problem, your fixes in turn break other things. Why is grammar so difficult to write? Well, it’s a set of rules which must satisfy unknown criteria (there are many edge cases or different ways to write the same functionality) and to add to the complexity the order in which the rules are written are important. In essence we were working to create a key to fit all locks with very little feedback as to whether positive progress is being made. The error metrics from the pipeline, gave some insight into our failure rates and where to focus efforts but this was not sufficient to solve the problem in the given time.</p>
<p>Now, what if you didn’t have to match the whole program? And could use different specialised grammars against different parts of the program. This is the idea behind ANTLRv4, enabling information to be extracted from the formal language of code but without the need to understand or write a complete set of grammar rules. Sadly we wrote out initial pipeline around ANTLRv3, as our technical lead had most experience with this version. He spent some time with ANTLRv4 and thought it to be a viable option for the next phase of work.</p>
<h2 id="epilogue">Epilogue</h2>
<p>Putting all the pieces together and we applied ourselves to the question – how is information extracted from IDBR? We found the sequence of programs called from where the initial sampling criteria are entered, to a selection, to sample table creation and then finally to how files are saved to disk. This was of use to the Business Survey Data Collection (BSDC) team who required insight as how their data is generated. Overall when considering this method in use we were able to find database functionality through a semi-automated process and showed that this method may work for finding all functionality. However, our information was only partially complete, as the process of semantic analysis didn’t find all tables and their relationships due to incomplete grammar.</p>
<p>Finally, I had a great time working on this, the mixture of mashing different frameworks together to create a pipeline, graph traversal, visualisation and then optimisation of grammar presented many complex (and interesting) problems. The application of this work is core to the success and validation of SBR and informs the best strategy for how to smooth the transition from IDBR to SBR.</p>
<p><strong>End.</strong></p>
<h2 id="key-links">Key Links</h2>
<p>ONS Digital continued to develop around the themes of an Address Index for all UK address, a Business Index for all UK businesses and a Statistical Business Register as a data source for statistical generation. The code for each project are open sourced below &ndash;</p>
<ul>
<li><a href="https://github.com/ONSdigital/address-index-api">ONS Digital Github: Address Index</a></li>
<li><a href="https://github.com/ONSdigital/business-index-api">ONS Digital Github: Business Index</a></li>
<li><a href="https://github.com/ONSdigital/sbr-api">ONS Digital Github: Statistical Business Register</a></li>
</ul>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://jdzool.github.io/tags/external-blog">external-blog</a></span><span class="tag"><a href="https://jdzool.github.io/tags/project-review">project-review</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1647 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2017-02-03 11:23 &#43;0000</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://jdzool.github.io/posts/2017-book-review-superintelligence/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Book Review: Superintelligence by Nick Bostrom</span>
                            </a>
                        </span>
                    

                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span>
            <span> <a href="https://jdzool.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Theme by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4a69500057d68129e88f497d354afe68422eb56de6d15e45dbe2190858ea5a76bfcb096406f992984b241db45f47388ac57ab0376e3b32125bef7a8a6d0f06c4.js" integrity="sha512-SmlQAFfWgSnoj0l9NUr&#43;aEIutW3m0V5F2&#43;IZCFjqWna/ywlkBvmSmEskHbRfRziKxXqwN247MhJb73qKbQ8GxA=="></script>



    </body>
</html>
